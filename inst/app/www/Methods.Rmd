---
output: 
  html_fragment
bibliography: ptpt.bib
---

```{r render,include = FALSE,echo = FALSE}
# Need to fix toc formatting - probably in css or header/footer files
library(dplyr)
library(gt)
```

<span style="color: red;">**NOTE**</span>

This documentation is still under review. Be aware that the content may change.
Check the github commit history for this project's [repo](github.com/apeterson91/ptpt)
to see when changes are made.

# Overview 

The methodology underlying the PTPT falls under two headings (1) Data Collection
and (2) Substantive Questions. Data collection is laid out in three stages with 
increasing difficulty and correspondingly higher quality data 
associated with each successive stage. Methods for investigating substantive 
questions develop in parallel to Data Collection; models and estimates 
discussed under this heading should be available 
with minor adjustment for each of the three data stages. 
These methods are understood to be open ended and falling under two headings: 
(1) Descriptive and (2) Prescriptive. That is, methods are developed with the 
intent to describe the current state of transit use in Pittsburgh, as well as to 
"prescribe" in decision theoretic terms, what actions (interventions, 
programs, etc.) may lead to a greater uptake in one mode of transit over 
another.


# Data Collection 

Before explaining the strategy behind each stage of data collection we introduce
notation so that the technical reader can identify consistent terms 
across all stages of data collection and methods.

Consider the $i$th PGH resident, $(i=1,...,N)$ who performs each of $K$ trips 
on a regular basis, say a typical week. We assume, to start, that the mode of 
transit is fixed per trip - a person **only** walks (for example) to the 
grocery store. The mode of transit for the $i$th resident is denoted as $m_i$,
where $m_i \in \{1,...,M\}$ and $M$ is the total possible modes of transit. 
This resident may also have certain characteristics, such as race, income, etc.
that may be relevant to understanding their mode choice. We denote the 
vector of these $p$ characteristics as $Z_i \in \mathbb{R}^{p}$. Similarly,
we measure route-specific characteristics, $X_i \in \mathbb{R}^q$, which 
may include the difference in expected travel time to a given destination
between biking and driving.

With this preliminary notation aside, we now describe how these data are 
collected or generated in each of the three stages constituting the PTPT's 
development.

## Stage 1: Simulated Data {.tabset}


```{r dtbl, echo = FALSE}
tibble(`Organization` = c("WPRDC","WPRDC","WPRDC",
                         "WPRDC","WPRDC",
                         "OSM","OSM"),
       `Dataset` = c("Neighborhood Boundaries",
                       "Street Lines",
                       "Bike Lines",
                       "Zoning Boundaries",
                       "Land Parcels",
                       "Grocery Store Locations",
                       "Trip Routes/Times"
                       )) %>% 
    gt(caption = "Table 1") %>% 
    tab_header("Data Sources")
```
### Big Picture

The first stage of data "collection" for the PTPT is using simulated data. 
There are several reasons for this. To begin with, simulating data is cheap and 
quick while still providing some semblance of realism. Indeed, using the wealth
of data sources available through the [WPRDC](http://www.wprdc.org/) as well
as American Community Survey data available through the 
[census](https://www.census.gov/programs-surveys/acs), open source
data available through [openstreetmap](https://www.openstreetmap.org/), 
elevation data provided by 
[NASA](https://earthdata.nasa.gov/esds/competitive-programs/measures/nasadem), 
and more that can be seen in Table 1, simulated data offer us 
the chance to quickly summon various scenarios of how transit behavior may vary 
amongst Pittsburgh residents. To this end, we sample 100 fictitious residents 
across the 88 neighborhoods of Pittsburgh, assign them a random residential 
parcel and generate three trips - grocery, commute and social - by three modes 
of transit - walking, biking and driving a personal vehicle. From these we then 
generate a mode of transit using a discrete choice model. See the Technical Tab 
for further details.

Further work in generating data will incorporate further modes of transit, and 
hypothetical modes of data collection that account for shared household trips, 
e.g. two subject participants make two different commute trips, but one shared
grocery trip. These two will be of primary focus to better reflect both the
transit reality of Pittsburghers as well as the likely reality of future data 
collection - clustered sampling - to which we now turn in greater detail
in the next section.


### Technical

We follow previous work in the transit literature by simulating data under a 
discrete choice model framework [ben1985discrete; @paez2008discrete; goetzke2008].
Specifically we generate $m_i \in \{\text{Bike},\text{Walk},\text{Drive}\}$, 
where the odds of biking and walking to a destination are modeled on a logit 
scale as a function of both subject level characteristics, $Z_i$, and route 
specific characteristics $X_i$, which include the difference in estimated 
trip time duration between biking/walking and driving, or, in the future, 
the perceived physical difficulty of the route measured by e.g. 
average route gradient. The general model is then,

\begin{equation}
m_i | X_i,Z_i \sim \text{Multinomial}(\pi^{b}_i,\pi^w_i,\pi_i^d) \\
\log(\frac{\pi_i^b}{\pi_i^d}) = \alpha_b + f_b(X_i) + g_b(Z_i)\\
\log(\frac{\pi_i^w}{\pi_i^d}) = \alpha_w + f_w(X_i) + g_w(Z_i),
(\#eq:s1model)
\end{equation}

where $\pi_i^b,\pi_i^w,\pi_i^d$ are the respective probabilities of the $i$th 
person biking, walking or driving to a destination, respectively, and 
$f_*(X_i)$^{the asterik here refers to either the biking or walking function} 
and $g_*(Z_i)$ are the unknown functions of person and route 
specific traits that influence an individual's propensity to bike or walk
instead of drive to a specific destination. For example, it is likely the 
case that one may be more inclined to bike or walk to a destination if the 
difference between walking and driving is small and the overall trip time is 
expected to be low, to reduce the hassle of driving and parking. However this 
inclination will rapidly decline as the difference increases and the overall 
absolute trip time increases. Consequently, we formulate this understanding
by having $g_*(\cdot)$ be an exponential function of the aforementioned 
quantities. 

For a full understanding of how the data are generated we encourage the 
interested reader to see the code in the `data_raw/` folder in this 
project's [github repo](https://github.com/apeterson91/PTPT).

#### Known omissions

The modeling framework described above contains a number of known omissions 
we briefly enumerate here and leave for future version updates of stage 1 of 
the PTPT. The first is the omission of social dependency effects in the mean
function of \@ref(eq:s1model) and explored in [@paez2008discrete; @goetzke2008].
Future versions of the PTPT will look to incorporate these effects.

While not explicitly an omission, a final weakness associated with simulated
data we acknowledge is that the data are *not* observations of individuals 
making decisions about how to move about Pittsburgh. Our second stage dataset
addresses this concern and builds upon the previous work laid out in stage 1.

## Stage 2: Convenience Sample  

Data collected in stage 2 represent a convenience sample drawn from members
of Bike PGH's neighborhood advocacy network. While certainly **not** a random
sample of the greater Pittsburgh  community, this sample does offer the chance
to test the mechanics underlying the PTPT and roll-up the online survey 
submission process associated with the PTPT as well as address any early 
concerns that may arise in administering the online survey.

From a technical standpoint, even though these data are not indepndent, there 
is still much that can be learned from using these data, and we plan to utilize
methods from the post-stratification literature 
[@gelman2007struggles; @lumley2011complex] in order to derive estimates 
that are more representative of the city.

## Stage 3: Designed Sample

The final stage would be a designed sample targeting households in the city 
of Pittsburgh and explicitly modeling non-response. This represents the 
final stage of possible data collection for the PTPT, the highest quality data
and, the most difficult data to acquire for this project. 


# Substantive Questions

## Propensity to transit - the estimand of interest

The primary estimand of interest and key indicator by which progress towards 
the goal of non-car dependence is measured is the probability of an individual
in the Pittsburgh area to use transit - a non-single passenger vehicle mode - 
to complete a within-city (or potentially within-county) trip, $\pi_t$.


## Transit factors

In addition to estimating $\pi_t$ we are interested in what factors influence
$\pi_t$. These include the functions $f_*(X_i)$ and $g_*(Z_i)$ described 
earlier.


# Discussion 



# References





